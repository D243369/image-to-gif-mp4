<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>画像 → GIF / MP4 変換（ブラウザ内完結）</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <main class="wrap">
    <header class="card header">
      <h1 class="title">画像 → GIF / MP4 変換</h1>
      <p class="desc">
        読み込み・変換・書き出しは、すべてお使いのブラウザ内で実行されます。
        <br>画像をサーバーへ送信する処理はありません。
      </p>

      <div class="tabs" role="tablist" aria-label="出力形式">
        <button id="tabGif" class="tab active" role="tab" aria-selected="true">GIF</button>
        <button id="tabMp4" class="tab" role="tab" aria-selected="false">MP4</button>
      </div>
      <small class="kicker">※ MP4はブラウザ/端末によって対応状況が異なります（未対応の場合は失敗することがあります）。</small>
    </header>

    <section class="card">
      <div id="dropzone" class="dropzone" tabindex="0" aria-label="画像アップロード">
        <div class="dz-inner">
          <div class="dz-icon">⬆</div>
          <div class="dz-title">画像をドラッグ＆ドロップ</div>
          <div class="dz-sub">またはクリックして選択（JPG / PNG / WebP）</div>
        </div>
        <input id="fileInput" class="file" type="file" accept="image/*" />
      </div>

      <div class="grid">
        <div>
          <h2 class="h2">Preview</h2>
          <div class="preview">
            <img id="previewImg" alt="preview" />
            <div id="previewEmpty" class="preview-empty">画像が未選択です</div>
          </div>
        </div>

        <aside>
          <h2 class="h2">Settings</h2>

          <div id="panelGif" class="panel">
            <p class="note">
              GIFは「2フレームの静止画風」で生成します。<br>
              GIFは仕様上 256色制限があるため、写真やグラデーションでは劣化する場合があります。
            </p>
          </div>

          <div id="panelMp4" class="panel" hidden>
            <div class="row">
              <label for="mp4Seconds">再生時間（秒）</label>
              <input id="mp4Seconds" type="number" min="1" max="30" value="3" />
              <span class="note">1–30</span>
            </div>
            <div class="row" style="grid-template-columns: 1fr 1fr;">
              <label for="mp4Bitrate">ビットレート（目安）</label>
              <input id="mp4Bitrate" type="range" min="10" max="100" value="90" />
            </div>
            <p class="note">値を上げるほど高画質になりますが、変換時間やファイルサイズも増えます。</p>
          </div>

          <div class="actions">
            <div class="fileline">
              <span class="filelabel">選択ファイル:</span>
              <span id="fileName" class="filename">（未選択）</span>
            </div>
            <button id="btnConvert" class="primary" disabled>変換する</button>
            <button id="btnDownload" class="download" hidden>ダウンロード</button>
            <button id="btnReset" class="ghost">リセット</button>
            <div id="status" class="status">画像を選択してください</div>
          </div>
        </aside>
      </div>
    </section>

    <footer class="footer">
      <div class="panel">
        <p class="section-title">このツールの動作について</p>
        <p class="note">
          画像の読み込み・変換・書き出しは、すべてお使いのブラウザ内で行われます。サーバーへ画像を送信する処理はありません。
          <br>また、本ツールは形式変換のみを行い、AIによる加工・生成は使用していません。
        </p>
        <p class="note" style="margin-top:10px;">
          ただし、ブラウザや端末の環境によって挙動や対応形式が変わる場合があります。
          気になる方は無理に使用せず、自己責任の範囲でご利用ください。
        </p>

        <p class="section-title" style="margin-top:14px;">著作権・利用上の注意</p>
        <ul class="note">
          <li>アップロード（選択）した画像の権利は、画像の権利者に帰属します。</li>
          <li>本ツールで生成されたGIF/MP4についても、元画像の権利者に帰属します。</li>
          <li>本ツールは変換処理のみで、権利の取得・移転・放棄を行いません。</li>
          <li>第三者の権利を侵害する画像の利用は禁止です。</li>
          <li>利用する画像について、適切な権利・許諾があることを確認してください。</li>
        </ul>
      </div>
    </footer>
  </main>

  <!-- GIFエンコーダ（先に読む） -->
  <script src="./libs/gifjs/gif.js"></script>
  <!-- MP4 muxer (WebCodecs → MP4) -->
  <script src="./libs/mp4-muxer/mp4-muxer.js"></script>
  <!-- メイン処理 -->
  <script src="./app.js" defer></script>
</body>
</html>
